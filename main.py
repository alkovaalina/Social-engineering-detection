import numpy as np
from tabulate import tabulate

questions = [
    "Q1: Чи ведеться повне логування email-транзакцій на Email Server (включаючи метадані, IP, вкладення)?",
    "Q2: Чи проводиться регулярне навчання персоналу щодо розпізнавання фішингових повідомлень та підозрілих посилань?",
    "Q3: Чи моніторяться журнали браузера на Робочих станціях для виявлення підозрілих URL та сеансів?",
    "Q4: Чи є система виявлення аномальних Logon Events на Domain Controller?",
    "Q5: Чи фіксуються підключення зовнішніх пристроїв (наприклад, USB) на Робочих станціях та Engineering Workstation?",
    "Q6: Чи ведеться аудит DHCP logs на Серверах застосунків для виявлення підозрілих IP-призначень?",
    "Q7: Чи моніторяться Communication logs на OPC Server для аномальних запитів?",
    "Q8: Чи є фізичний контроль доступу до зон з HMI та Робочими станціями (камери, картки доступу)?",
    "Q9: Чи проводиться перевірка конфігураційних змін на IED та PLC/RTU?",
    "Q10: Чи ведеться логування Issued commands на HMI для виявлення нетипових дій?",
    "Q11: Чи є система оповіщення про підозрілі MAC-адреси на Комутаторах (CAM tables)?",
    "Q12: Чи моніторяться журнали подій на Маршрутизаторах для аномального трафіку?",
    "Q13: Чи проводиться навчання щодо фізичних атак, таких як shoulder surfing чи tailgating?",
    "Q14: Чи є політика утилізації документів та носіїв даних для запобігання dumpster diving?",
    "Q15: Чи фіксуються Attached device logs на Робочих станціях для зовнішніх носіїв?",
    "Q16: Чи ведеться аудит Security Events на Domain Controller для незвичайних аутентифікацій?",
    "Q17: Чи моніторяться Session Data на Веб сервері для підозрілих сеансів?",
    "Q18: Чи є IDS/IPS налаштовані на виявлення аномального мережевого трафіку (Log Data)?",
    "Q19: Чи проводиться перевірка версій ПЗ на IED та PLC для вразливостей?",
    "Q20: Чи ведеться логування Program/File execution на Engineering Workstation?",
    "Q21: Чи є система оповіщення про Alarm and Alert Data на IED?",
    "Q22: Чи моніторяться DMBS logs на Historian для змін у базі даних?",
    "Q23: Чи проводиться аудит браузерної історії на Робочих станціях для water-holing?",
    "Q24: Чи є політика верифікації джерел допомоги (для reverse social engineering)?",
    "Q25: Чи ведеться логування подій на Firewall/IDS/IPS для блокованих запитів?"
]

scenarios = [
    "Фішинг (Email/Website)",
    "Spear-phishing / Whaling",
    "Baiting",
    "Water-Holing",
    "Pretexting",
    "Reverse Social Engineering"
]

W = np.array([
    [0.1538, 0.2222, 0.0000, 0.0248, 0.0270, 0.1290],
    [0.1538, 0.2222, 0.0000, 0.0248, 0.0270, 0.1290],
    [0.0769, 0.0000, 0.0612, 0.1733, 0.0000, 0.1935],
    [0.0769, 0.2222, 0.0612, 0.0000, 0.0811, 0.0645],
    [0.0000, 0.0000, 0.1837, 0.0000, 0.0000, 0.0000],
    [0.0000, 0.0000, 0.1020, 0.0000, 0.0000, 0.0000],
    [0.0000, 0.0000, 0.0612, 0.0000, 0.0000, 0.0000],
    [0.0000, 0.0000, 0.0000, 0.0000, 0.2162, 0.0645],
    [0.0385, 0.0556, 0.0000, 0.0000, 0.1081, 0.0000],
    [0.0000, 0.0000, 0.0000, 0.0000, 0.2162, 0.0645],
    [0.0000, 0.0000, 0.0000, 0.0000, 0.0000, 0.0000],
    [0.0385, 0.0556, 0.0612, 0.0990, 0.0811, 0.0000],
    [0.0385, 0.0000, 0.0000, 0.0990, 0.2162, 0.0000],
    [0.0000, 0.0000, 0.0000, 0.0248, 0.0000, 0.0000],
    [0.0000, 0.0000, 0.1837, 0.0248, 0.0000, 0.0645],
    [0.0769, 0.2222, 0.0612, 0.0000, 0.1081, 0.0000],
    [0.0769, 0.1111, 0.0612, 0.1733, 0.0811, 0.1935],
    [0.1538, 0.0556, 0.0612, 0.1733, 0.0000, 0.1290],
    [0.0000, 0.0000, 0.0612, 0.0000, 0.0000, 0.0000],
    [0.0000, 0.0000, 0.1020, 0.0248, 0.0000, 0.0645],
    [0.0000, 0.0000, 0.0612, 0.0248, 0.1081, 0.0000],
    [0.0385, 0.1111, 0.0000, 0.0000, 0.0000, 0.0000],
    [0.0769, 0.0000, 0.0000, 0.1733, 0.0000, 0.0000],
    [0.0000, 0.0556, 0.0000, 0.0000, 0.0811, 0.1935],
    [0.0769, 0.0000, 0.1020, 0.1733, 0.0000, 0.0000]
])

scores = []
print("Введіть оцінки для 25 питань (1–5).")
for q in questions:
    while True:
        try:
            score = int(input(f"{q} (Оцінка 1–5): "))
            if 1 <= score <= 5:
                scores.append(score)
                break
            else:
                print("Оцінка повинна бути від 1 до 5.")
        except ValueError:
            print("Введіть ціле число від 1 до 5.")

norm_scores = [s / 5.0 for s in scores]

DP = np.dot(norm_scores, W)
DP = np.clip(DP, 0, 1.0)
Pnd = 1 - DP

table_data = []
for i, scenario in enumerate(scenarios):
    risk_status = "*** Високий ризик ***" if Pnd[i] > 0.5 else ""
    table_data.append([scenario, f"{Pnd[i]:.4f}", risk_status])

print("\nЙмовірність невиявлення (Pnd):")
print(tabulate(table_data, headers=["Сценарій", "Pnd", "Статус"], tablefmt="grid"))
